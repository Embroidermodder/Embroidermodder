#!/usr/bin/env python3

"""
Embroidermodder 2
Copyright 2011-2025 The Embroidermodder Team

Embroidermodder 2 is free and open software under the zlib license:
see LICENSE.md for details.

------------------------------------------------------------------------------

Helper script to generate the 4 C headers:

    * src/commands.h
    * src/designs.h
    * src/fills.h
    * src/generators.h

by looping over the filenames and determining the function prototypes.

For each file in the associated folder there should be a function of the
same name with the suffix "_command" for the "commands" directory like this:

FILE src/commands/pan.c => int pan_command(State *state);
"""

import os

copyright_message = r"""/*
 * Embroidermodder 2
 * Copyright 2011-2025 The Embroidermodder Team
 *
 * Embroidermodder 2 is free and open software under the zlib license:
 * see LICENSE.md for details.
 *
 * ----------------------------------------------------------------------------
 *
 * THIS FILE IS GENERATED BY "bin/gen_headers.py". DO NOT ALTER DIRECTLY.
 *
 * The %s that are written in C which only act via the state variable.
 */
"""

header = r"""
#ifndef __EM2_%s__
#define __EM2_%s__

#ifdef __cplusplus
extern "C" {
#endif

#include "core.h"

"""

footer = r"""
#ifdef __cplusplus
}
#endif

#endif
"""

def generate_prototype(folder, file):
    name = file[:-2] + "_" + folder[:-1]
    return "int " + name + "(State *state);\n"

def make_header(folder):
    print("Generating \"" + folder + "\" header...")

    files = [file for file in os.listdir("src/" + folder)]
    files = sorted(files)

    block = folder.upper()
    txt = copyright_message % folder
    txt += header % (block, block)
    for file in files:
        txt += generate_prototype(folder, file)
    txt += footer

    with open("src/" + folder + ".h", "w") as f:
        f.write(txt)

folders = [
    "commands",
    "designs",
    "fills",
    "generators"
]

for folder in folders:
    make_header(folder)
